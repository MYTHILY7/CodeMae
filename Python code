import os
import logging
from bs4 import BeautifulSoup

# Setup logging
logging.basicConfig(level=logging.INFO, format='%(levelname)s: %(message)s')

def extract_note_page(soup):
    """Find the div.Page containing 'NOTE' in any heading"""
    for heading in soup.find_all(['h1', 'h2', 'h3']):
        if heading.get_text(strip=True).lower() == "note":
            page_div = heading.find_parent('div', class_='Page')
            if page_div:
                return page_div
    return None

def check_fixed_rate_in_footer(note_div):
    """Search for 'FIXED RATE' anywhere in the footer or final section"""
    footer_tags = note_div.find_all(['footer', 'p', 'span', 'div'])
    for tag in footer_tags:
        text = tag.get_text(separator=' ', strip=True).lower()
        if "fixed rate" in text:
            return True
    return False

def process_html_file(file_path):
    try:
        with open(file_path, 'r', encoding='utf-8') as f:
            content = f.read()
        soup = BeautifulSoup(content, 'html.parser')
        
        note_div = extract_note_page(soup)
        if not note_div:
            return f'❌ FAIL: NOTE section not found in file: {os.path.basename(file_path)}'

        if check_fixed_rate_in_footer(note_div):
            return f'✅ PASS: FIXED RATE found in NOTE footer for file: {os.path.basename(file_path)}'
        else:
            return f'❌ FAIL: FIXED RATE not found in NOTE footer for file: {os.path.basename(file_path)}'
    
    except Exception as e:
        return f'❌ FAIL: Error processing file {os.path.basename(file_path)} - {str(e)}'

# ----------- Sample Usage -----------

if __name__ == "__main__":
    html_files = [
        'pdf1.html',
        'pdf10.html',
        'pdf1454.html'
    ]
    
    for file in html_files:
        result = process_html_file(file)
        print(result)
